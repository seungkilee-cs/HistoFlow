version: "3.9"

services:
  minio:
    image: minio/minio:RELEASE.2024-10-02T17-50-41Z
    env_file:
      - ./minio.env
    command: server /data --console-address ":9001"
    volumes:
      - minio-data:/data

  backend:
    build:
      context: ../backend
    environment:
      SPRING_APPLICATION_JSON: '{"minio":{"endpoint":"http://minio:9000","public-endpoint":"http://localhost:9000","access-key":"minioadmin","secret-key":"minioadmin","buckets":{"tiles":"histoflow-tiles"}}}'
    depends_on:
      - minio

  tiling:
    build:
      context: ../services/tiling
    env_file:
      - ../services/tiling/.env
    environment:
      MINIO_ENDPOINT: minio:9000
      MINIO_SECURE: "false"
    depends_on:
      - minio

volumes:
  minio-data:
